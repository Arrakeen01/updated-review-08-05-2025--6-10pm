<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPARK Mobile Upload - Secure Document Upload</title>
    <meta name="description" content="Secure mobile document upload for SPARK Document Management System">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- QR Code Scanner Library (for future use) -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    
    <style>
        .upload-container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        
        .file-drop-zone {
            border: 2px dashed #d1d5db;
            transition: all 0.3s ease;
        }
        
        .file-drop-zone:hover {
            border-color: #9ca3af;
            background-color: #f9fafb;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4">
                <i data-lucide="shield" class="text-white w-8 h-8"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">S.P.A.R.K.</h1>
            <p class="text-lg text-gray-600">Secure Police Archival & Record Keeper</p>
            <p class="text-sm text-gray-500 mt-2">Mobile Document Upload</p>
        </div>

        <!-- Session Status -->
        <div id="session-status" class="upload-container mb-6">
            <div class="bg-white rounded-xl shadow-lg p-4">
                <div class="flex items-center justify-center space-x-2">
                    <div class="loading-spinner w-6 h-6"></div>
                    <span class="text-gray-600">Validating session...</span>
                </div>
            </div>
        </div>

        <!-- Upload Section -->
        <div id="upload-section" class="bg-white rounded-xl shadow-lg p-6 mb-6 upload-container hidden">
            <div class="text-center mb-6">
                <div class="inline-flex items-center justify-center w-12 h-12 bg-blue-100 rounded-full mb-3">
                    <i data-lucide="upload" class="text-blue-600 w-6 h-6"></i>
                </div>
                <h2 class="text-xl font-semibold text-gray-900 mb-2">Upload Documents</h2>
                <p class="text-gray-600 text-sm">Select files or drag and drop to upload securely</p>
                <div class="mt-2 bg-blue-50 border border-blue-200 rounded-lg px-3 py-2">
                    <p class="text-xs text-blue-700">
                        <strong>Session:</strong> <span id="display-session-id"></span>
                    </p>
                </div>
            </div>

            <!-- File Upload Area -->
            <div class="space-y-4">
                <!-- Drag & Drop Zone -->
                <div id="drop-zone" class="file-drop-zone rounded-lg p-8 text-center cursor-pointer">
                    <div class="space-y-3">
                        <i data-lucide="cloud-upload" class="w-12 h-12 text-gray-400 mx-auto"></i>
                        <div>
                            <p class="text-lg font-medium text-gray-700">Drop files here</p>
                            <p class="text-sm text-gray-500">or click to browse files</p>
                        </div>
                        <div class="text-xs text-gray-400">
                            <p>Supported: JPEG, PNG, PDF (Max: 10MB each)</p>
                        </div>
                    </div>
                </div>

                <!-- File Input (Hidden) -->
                <input type="file" id="file-input" multiple accept="image/jpeg,image/png,image/jpg,application/pdf" class="hidden">

                <!-- Selected Files Display -->
                <div id="selected-files" class="space-y-2 hidden">
                    <h3 class="text-sm font-semibold text-gray-700">Selected Files:</h3>
                    <div id="files-list" class="space-y-2"></div>
                </div>

                <!-- Upload Button -->
                <button id="upload-btn" class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed hidden">
                    <span class="flex items-center justify-center">
                        <i data-lucide="upload" class="w-4 h-4 mr-2"></i>
                        Upload Documents
                    </span>
                </button>
            </div>

            <!-- Upload Progress -->
            <div id="upload-progress" class="mt-6 hidden">
                <div class="bg-gray-200 rounded-full h-2">
                    <div id="progress-bar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
                <p id="progress-text" class="text-sm text-gray-600 mt-2 text-center">Uploading...</p>
            </div>

            <!-- Upload Results -->
            <div id="upload-results" class="mt-6 space-y-3 hidden">
                <h3 class="text-sm font-semibold text-gray-700">Upload Results:</h3>
                <div id="results-list"></div>
            </div>
        </div>

        <!-- Session Invalid -->
        <div id="invalid-session" class="text-center upload-container hidden">
            <div class="bg-white rounded-xl shadow-lg p-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4">
                    <i data-lucide="alert-circle" class="text-red-600 w-8 h-8"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Invalid Session</h3>
                <p class="text-gray-600 mb-4">
                    This upload session has expired or is invalid. Please scan a new QR code from the SPARK system.
                </p>
                <div class="text-sm text-gray-500">
                    Session ID: <span id="invalid-session-id">Not provided</span>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 upload-container">
            <div class="flex items-start space-x-3">
                <div class="flex-shrink-0">
                    <i data-lucide="info" class="text-blue-600 w-5 h-5 mt-0.5"></i>
                </div>
                <div>
                    <h3 class="text-sm font-medium text-blue-900 mb-2">Upload Instructions:</h3>
                    <ul class="text-sm text-blue-800 space-y-1 list-disc list-inside">
                        <li>Take clear photos of documents</li>
                        <li>Ensure all text, stamps, and signatures are visible</li>
                        <li>Multiple files can be uploaded at once</li>
                        <li>Files are processed automatically with AI</li>
                        <li>Results appear instantly on the PC interface</li>
                    </ul>
                    <div class="mt-4 p-3 bg-blue-100 rounded-lg">
                        <p class="text-xs text-blue-700">
                            <strong>Security:</strong> All uploads are encrypted and stored securely. 
                            This session will expire automatically for your protection.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 text-sm text-gray-500">
            <p>&copy; 2025 Andhra Pradesh Police Department</p>
            <p class="mt-1">Secure Document Management System</p>
        </div>
    </div>

    <script>
        class SPARKMobileUpload {
            constructor() {
                this.sessionId = null;
                this.selectedFiles = [];
                this.isUploading = false;
                
                this.initializeElements();
                this.initializeLucideIcons();
                this.bindEvents();
                this.validateSession();
            }

            initializeElements() {
                this.elements = {
                    sessionStatus: document.getElementById('session-status'),
                    uploadSection: document.getElementById('upload-section'),
                    invalidSession: document.getElementById('invalid-session'),
                    dropZone: document.getElementById('drop-zone'),
                    fileInput: document.getElementById('file-input'),
                    selectedFiles: document.getElementById('selected-files'),
                    filesList: document.getElementById('files-list'),
                    uploadBtn: document.getElementById('upload-btn'),
                    uploadProgress: document.getElementById('upload-progress'),
                    progressBar: document.getElementById('progress-bar'),
                    progressText: document.getElementById('progress-text'),
                    uploadResults: document.getElementById('upload-results'),
                    resultsList: document.getElementById('results-list'),
                    displaySessionId: document.getElementById('display-session-id'),
                    invalidSessionId: document.getElementById('invalid-session-id')
                };
            }

            initializeLucideIcons() {
                lucide.createIcons();
            }

            bindEvents() {
                // Drop zone events
                this.elements.dropZone.addEventListener('click', () => this.elements.fileInput.click());
                this.elements.dropZone.addEventListener('dragover', this.handleDragOver.bind(this));
                this.elements.dropZone.addEventListener('dragleave', this.handleDragLeave.bind(this));
                this.elements.dropZone.addEventListener('drop', this.handleDrop.bind(this));
                
                // File input change
                this.elements.fileInput.addEventListener('change', this.handleFileSelect.bind(this));
                
                // Upload button
                this.elements.uploadBtn.addEventListener('click', this.uploadFiles.bind(this));
            }

            validateSession() {
                // Get session ID from URL parameters
                const urlParams = new URLSearchParams(window.location.search);
                this.sessionId = urlParams.get('session');
                
                if (!this.sessionId) {
                    this.showInvalidSession('No session ID provided');
                    return;
                }
                
                // Display session ID (truncated)
                this.elements.displaySessionId.textContent = this.sessionId.substring(0, 20) + '...';
                this.elements.invalidSessionId.textContent = this.sessionId;
                
                // For now, assume session is valid since we don't have backend validation here
                // In production, you'd validate against your backend
                this.showUploadSection();
            }

            showUploadSection() {
                this.elements.sessionStatus.classList.add('hidden');
                this.elements.uploadSection.classList.remove('hidden');
                this.elements.invalidSession.classList.add('hidden');
            }

            showInvalidSession(reason) {
                this.elements.sessionStatus.classList.add('hidden');
                this.elements.uploadSection.classList.add('hidden');
                this.elements.invalidSession.classList.remove('hidden');
            }

            handleDragOver(e) {
                e.preventDefault();
                this.elements.dropZone.classList.add('drag-over');
            }

            handleDragLeave(e) {
                e.preventDefault();
                this.elements.dropZone.classList.remove('drag-over');
            }

            handleDrop(e) {
                e.preventDefault();
                this.elements.dropZone.classList.remove('drag-over');
                
                const files = Array.from(e.dataTransfer.files);
                this.addFiles(files);
            }

            handleFileSelect(e) {
                const files = Array.from(e.target.files);
                this.addFiles(files);
            }

            addFiles(files) {
                // Filter valid files
                const validFiles = files.filter(file => {
                    const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
                    const maxSize = 10 * 1024 * 1024; // 10MB
                    
                    return validTypes.includes(file.type) && file.size <= maxSize;
                });

                // Add to selected files
                this.selectedFiles = [...this.selectedFiles, ...validFiles];
                this.displaySelectedFiles();
                
                if (validFiles.length !== files.length) {
                    alert(`Some files were skipped. Only JPEG, PNG, and PDF files under 10MB are allowed.`);
                }
            }

            displaySelectedFiles() {
                if (this.selectedFiles.length === 0) {
                    this.elements.selectedFiles.classList.add('hidden');
                    this.elements.uploadBtn.classList.add('hidden');
                    return;
                }

                this.elements.selectedFiles.classList.remove('hidden');
                this.elements.uploadBtn.classList.remove('hidden');

                this.elements.filesList.innerHTML = '';
                this.selectedFiles.forEach((file, index) => {
                    const fileDiv = document.createElement('div');
                    fileDiv.className = 'flex items-center justify-between p-2 bg-gray-50 rounded';
                    fileDiv.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <i data-lucide="file" class="w-4 h-4 text-gray-500"></i>
                            <span class="text-sm font-medium">${file.name}</span>
                            <span class="text-xs text-gray-500">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
                        </div>
                        <button onclick="mobileUpload.removeFile(${index})" class="text-red-600 hover:text-red-800">
                            <i data-lucide="x" class="w-4 h-4"></i>
                        </button>
                    `;
                    this.elements.filesList.appendChild(fileDiv);
                });

                // Re-initialize icons for new elements
                lucide.createIcons();
            }

            removeFile(index) {
                this.selectedFiles.splice(index, 1);
                this.displaySelectedFiles();
            }

            async uploadFiles() {
                if (this.selectedFiles.length === 0 || this.isUploading) return;

                this.isUploading = true;
                this.elements.uploadBtn.disabled = true;
                this.elements.uploadProgress.classList.remove('hidden');
                this.elements.uploadResults.classList.add('hidden');

                const results = [];
                const totalFiles = this.selectedFiles.length;

                for (let i = 0; i < this.selectedFiles.length; i++) {
                    const file = this.selectedFiles[i];
                    
                    // Update progress
                    const progress = ((i + 1) / totalFiles) * 100;
                    this.elements.progressBar.style.width = `${progress}%`;
                    this.elements.progressText.textContent = `Uploading ${i + 1} of ${totalFiles}: ${file.name}`;

                    try {
                        // Simulate upload - In production, this would upload to your backend
                        await this.simulateUpload(file);
                        results.push({ file: file.name, status: 'success', message: 'Uploaded successfully' });
                    } catch (error) {
                        results.push({ file: file.name, status: 'error', message: error.message });
                    }
                }

                // Show results
                this.displayResults(results);
                
                // Reset
                this.selectedFiles = [];
                this.displaySelectedFiles();
                this.elements.uploadProgress.classList.add('hidden');
                this.elements.uploadBtn.disabled = false;
                this.isUploading = false;
            }

            async simulateUpload(file) {
                // Simulate upload delay
                await new Promise(resolve => setTimeout(resolve, 1000 + Math.random() * 2000));
                
                // In production, replace this with actual upload to your backend:
                // const formData = new FormData();
                // formData.append('file', file);
                // formData.append('sessionId', this.sessionId);
                // const response = await fetch('YOUR_UPLOAD_ENDPOINT', {
                //     method: 'POST',
                //     body: formData
                // });
                // if (!response.ok) throw new Error('Upload failed');
                
                return { success: true };
            }

            displayResults(results) {
                this.elements.uploadResults.classList.remove('hidden');
                this.elements.resultsList.innerHTML = '';

                results.forEach(result => {
                    const resultDiv = document.createElement('div');
                    resultDiv.className = `flex items-center space-x-2 p-2 rounded ${
                        result.status === 'success' ? 'bg-green-50 text-green-800' : 'bg-red-50 text-red-800'
                    }`;
                    
                    const icon = result.status === 'success' ? 'check-circle' : 'alert-circle';
                    resultDiv.innerHTML = `
                        <i data-lucide="${icon}" class="w-4 h-4"></i>
                        <span class="text-sm font-medium">${result.file}</span>
                        <span class="text-xs">- ${result.message}</span>
                    `;
                    
                    this.elements.resultsList.appendChild(resultDiv);
                });

                // Re-initialize icons
                lucide.createIcons();

                // Auto-hide results after 10 seconds
                setTimeout(() => {
                    this.elements.uploadResults.classList.add('hidden');
                }, 10000);
            }
        }

        // Initialize the mobile upload app
        let mobileUpload;
        document.addEventListener('DOMContentLoaded', () => {
            mobileUpload = new SPARKMobileUpload();
        });
    </script>
</body>
</html>